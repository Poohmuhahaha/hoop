---
import Navigation from '../../components/ui/Navigation.astro';
import Footer from '../../components/ui/Footer.astro';
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';

// Define the type for your post data
type Post = {
	id: string;
	data: {
		title: string;
		pubDate: Date;
		heroImage?: string;
		[key: string]: any;
	};
};

const posts = (await getCollection('knowledgehub')) as Post[];
posts.sort(
	(a, b) => a.data.pubDate.valueOf() - b.data.pubDate.valueOf(),
);
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Knowledge Hub</title>
		<style>
			@import 'tailwindcss';
			
			:root {
				--color-primary: #F9F4E1;
				--color-primary-light: #926c46;
				--color-primary-dark: #251403;
				--color-accent: #dc2626;
				--color-text: #111827;
				--color-border: #e5e7eb;
				--color-background: #ffffff;
				
				--spacing-xs: 10px;
				--spacing-sm: 40px;
				--spacing-md: 80px;
				--spacing-button: 30px;
				--spacing-between: 40px;
				
				--font-title: 40px;
				--font-description: 20px;
				
				--border-radius-md: 16px;
				
				--max-width-container: 1440px;
			}

			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
				line-height: 1.6;
				color: var(--color-text);
				background-color: var(--color-background);
			}

			.container {
				max-width: var(--max-width-container);
				margin: 0 auto;
				padding: 0 var(--spacing-md);
			}

			.news-section {
				padding: var(--spacing-md) 0;
			}

			.section-title {
				font-size: var(--font-title);
				font-weight: 700;
				color: var(--color-primary-dark);
				margin-bottom: var(--spacing-between);
				text-align: center;
			}

			.posts-grid {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
				gap: var(--spacing-between);
				list-style: none;
				margin: 0;
				padding: 0;
			}

			.post-card {
				background: var(--color-primary);
				border-radius: var(--border-radius-md);
				overflow: hidden;
				transition: all 0.3s ease;
				border: 2px solid var(--color-border);
				height: 100%;
				display: flex;
				flex-direction: column;
			}

			.post-card:hover {
				transform: translateY(-5px);
				box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
				border-color: var(--color-primary-light);
			}

			.post-link {
				text-decoration: none;
				color: inherit;
				display: flex;
				flex-direction: column;
				height: 100%;
			}

			.post-image {
				width: 100%;
				height: 250px;
				object-fit: cover;
				border-bottom: 2px solid var(--color-border);
			}

			.post-content {
				padding: var(--spacing-sm);
				flex-grow: 1;
				display: flex;
				flex-direction: column;
			}

			.post-title {
				font-size: 24px;
				font-weight: 600;
				color: var(--color-primary-dark);
				margin-bottom: var(--spacing-xs);
				line-height: 1.3;
				flex-grow: 1;
			}

			.post-date {
				font-size: 14px;
				color: var(--color-primary-light);
				margin-top: var(--spacing-xs);
				font-weight: 500;
			}

			.read-more {
				display: inline-flex;
				align-items: center;
				gap: 8px;
				color: var(--color-primary-light);
				font-weight: 500;
				margin-top: var(--spacing-xs);
				transition: color 0.3s ease;
			}

			.post-card:hover .read-more {
				color: var(--color-primary-dark);
			}

			.featured-post {
				grid-column: 1 / -1;
				max-width: 100%;
			}

			.featured-post .post-card {
				display: grid;
				grid-template-columns: 1fr 1fr;
				gap: 0;
				min-height: 400px;
			}

			.featured-post .post-image {
				height: 100%;
				border-bottom: none;
				border-right: 2px solid var(--color-border);
			}

			.featured-post .post-content {
				padding: var(--spacing-md);
			}

			.featured-post .post-title {
				font-size: 32px;
				margin-bottom: var(--spacing-sm);
			}

			.empty-state {
				text-align: center;
				padding: var(--spacing-md);
				color: var(--color-primary-light);
			}

			@media (max-width: 768px) {
				.container {
					padding: 0 var(--spacing-sm);
				}

				.posts-grid {
					grid-template-columns: 1fr;
					gap: var(--spacing-sm);
				}

				.featured-post .post-card {
					grid-template-columns: 1fr;
				}

				.featured-post .post-image {
					height: 250px;
					border-right: none;
					border-bottom: 2px solid var(--color-border);
				}

				.featured-post .post-content {
					padding: var(--spacing-sm);
				}

				.featured-post .post-title {
					font-size: 28px;
				}

				.section-title {
					font-size: 32px;
				}
			}

			@media (max-width: 480px) {
				.posts-grid {
					grid-template-columns: 1fr;
				}

				.post-content {
					padding: var(--spacing-sm);
				}

				.section-title {
					font-size: 28px;
				}
			}
		</style>
	</head>
	<body>
		<Navigation />
		<main>
			<div class="container">
				<section class="news-section">
					<h1 class="section-title">Knowledge Hub</h1>
					
					{posts.length > 0 ? (
						<ul class="posts-grid">
							{posts.map((post, index) => (
								<li class={index === 0 ? 'featured-post' : ''}>
									<div class="post-card">
										<a href={`/knowledgehub/${post.id}`} class="post-link">
											{post.data.heroImage && (
												<Image 
													width={index === 0 ? 800 : 400} 
													height={index === 0 ? 400 : 250} 
													src={post.data.heroImage} 
													alt={post.data.title}
													class="post-image"
												/>
											)}
											<div class="post-content">
												<h2 class="post-title">{post.data.title}</h2>
												<div class="read-more">
													Read more â†’
												</div>
												<p class="post-date">
													{post.data.pubDate.toLocaleDateString('en-US', {
														year: 'numeric',
														month: 'long',
														day: 'numeric'
													})}
												</p>
											</div>
										</a>
									</div>
								</li>
							))}
						</ul>
					) : (
						<div class="empty-state">
							<h2>No posts found</h2>
							<p>Check back later for new content.</p>
						</div>
					)}
				</section>
			</div>
		</main>
		<Footer />
	</body>
</html>