---
import Container from "../../components/ui/Container.astro";
import { getCollection } from "astro:content";
import { Image } from "astro:assets";
import BaseLayout from "../../layouts/BaseLayout.astro";
import Button from "../../components/ui/Button.astro";

type Post = {
  id: string;
  data: {
    title: string;
    description: string;
    pubDate: Date;
    heroImage?: string;
    [key: string]: any;
  };
};

const posts = (await getCollection("knowledgehub")) as Post[];
posts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<section class="bg-[#F9F4E1]">
  <BaseLayout>
    <Container>
      <h1 class="heading text-[40px]">Knowledge Hub</h1>

      {
        posts.length > 0 ? (
          <div class="gap-content grid grid-cols-12 grid-rows-2">
            {posts.map((post) => (
              <div class="col-span-4">
                <div class="card">
                  <div class="image-container">
                  {post.data.heroImage && (
                    <Image
                    width="720"
                    height="200"
                    src={post.data.heroImage}
                    alt={post.data.title}
                    class="image"
                    />
                  )}
                  </div>

                  <div class="card-content">
                    <div class="content">
                      <h2 class="title">{post.data.title}</h2>
                      <p class="date">
                        {post.data.pubDate.toLocaleDateString("en-US", {
                          year: "numeric",
                          month: "long",
                          day: "numeric",
                        })}
                      </p>
                      <p class="description text-[16px]">
                        {post.data.description}
                      </p>
                    </div>
                    <a href={`/knowledgehub/${post.id}`} class="card-link">
                      <Button class="button">Read more</Button>
                    </a>
                  </div>
                </div>
              </div>
            ))}
          </div>
        ) : (
          <div>
            <h2>No posts found</h2>
            <p>Check back later for new content.</p>
          </div>
        )
      }
    </Container>
  </BaseLayout>
</section>

<style>
  .gap-content {
    padding-bottom: var(--spacing-between);
  }

  .title {
    color: var(--color-primary-dark);
    font-size: var(--font-description);
    font-weight: bold;
  }
  .date {
    padding-bottom: 20px;
  }
  .card-link {
    width: 178px;
  }

  .card {
    display: flex;
    flex-direction: column;
    background-color: var(--color-primary);
  }

  .description {
    overflow: hidden;
    display: -webkit-box;
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 3;
  }

  .card-content {
    display: flex;
    flex-direction: column;
    gap: 40px;
  } 

  .gap-content {
    gap: var(--spacing-between);
  }

  .heading {
    padding-top: var(--spacing-between);
    padding-bottom: var(--spacing-between);
    font-weight: bold;
  }
  
  .image {
    border-radius: var(--border-radius-md);
  }
</style>
